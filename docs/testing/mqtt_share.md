以下是一个 MQTT 测试用例表，用于测试 MQTT 的共享订阅功能。

> 📌 说明：
> - 共享订阅语法：`$share/<group-name>/<topic-filter>`
> - 同一组内的多个订阅者**负载均衡接收消息**（每条消息仅被组内一个成员接收）
> - 不同组之间**独立广播**（每个组都会收到完整消息流）
> - 表格中“订阅”列填写客户端实际使用的**共享订阅主题**

---

### 🧪 MQTT 共享订阅（Shared Subscription）集成测试用例表

| ID | 描述 | 订阅 | QoS | 发布 | QoS | 预期 |
|----|------|------|-----|------|-----|------|
| SS-01 | 单组单消费者：正常接收 | `$share/g1/sensor/+/data` | 0 | `sensor/room1/data` | 0 | ✅ 客户端收到消息 |
| SS-02 | 单组多消费者：负载均衡（1 条消息） | `$share/g1/sensor/data`<br>（客户端 A 和 B 同时订阅） | 0 | `sensor/data` | 0 | ✅ 仅 A 或 B 中**一个**收到消息 |
| SS-03 | 单组多消费者：多条消息轮询分发 | `$share/g1/events`<br>（A、B 订阅） | 0 | 连续发布 4 条到 `events` | 0 | ✅ 消息大致均分（如 A:2, B:2），**无重复** |
| SS-04 | 多组订阅：各自独立接收全量 | A: `$share/g1/alerts`<br>B: `$share/g2/alerts` | 0 | `alerts` | 0 | ✅ A 和 B **都收到**每条消息（组间广播） |
| SS-05 | 共享订阅 + 通配符：匹配生效 | `$share/g1/floor/+/temp` | 0 | `floor/3/temp` | 0 | ✅ 匹配成功并接收 |
| SS-06 | 共享订阅不匹配非通配主题 | `$share/g1/a/b` | 0 | `a/c` | 0 | ❌ 不接收 |
| SS-07 | 组名不同视为不同组（大小写敏感） | A: `$share/Group1/data`<br>B: `$share/group1/data` | 0 | `data` | 0 | ✅ A 和 B **都收到**（因组名不同） |
| SS-08 | 空组名（非法） | `$share//sensor` | — | `sensor` | — | ❌ EMQX 拒绝订阅（SUBACK 失败） |
| SS-09 | 无 group 名（格式错误） | `$share/sensor` | — | — | — | ❌ 非法主题，订阅失败 |
| SS-10 | 共享订阅与普通订阅共存 | A: `$share/g1/status`<br>B: `status` | 0 | `status` | 0 | ✅ B（普通订阅）收到消息；A（共享组）也收到（组内负载）→ **总共至少 1 条（B）+ 可能 1 条（A）** |
| SS-11 | QoS 1 共享订阅：消息可靠投递 | `$share/g1/qos1-test` | 1 | `qos1-test` | 1 | ✅ 组内某客户端收到 QoS=1 消息，且无丢失 |
| SS-12 | 客户端离组后不再接收 | A、B 订阅 `$share/g1/job`<br>→ B 断开 | 0 | 发布 3 条到 `job` | 0 | ✅ 所有消息均由 A 接收（B 已离组） |
| SS-13 | 相同 client_id 重复加入同一组 | 同一 client_id 两次订阅 `$share/g1/x` | — | `x` | 0 | ⚠️ 第二次订阅通常覆盖第一次，**仍视为一个消费者** |
| SS-14 | 共享订阅支持 retain 消息？ | `$share/g1/retain-test` | 0 | `retain-test` (retain=true) | 0 | ❌ **通常不接收 retain 消息**（EMQX/HiveMQ 默认不向共享订阅派发 retain） |
| SS-15 | 共享订阅与系统主题（$SYS） | `$share/g1/$SYS/broker/version` | 0 | — | — | ❌ 不匹配（且 `$SYS` 通常禁止通配/共享订阅） |

---

### 🔍 关键行为说明（以 EMQX 为例）

| 行为 | 说明 |
|------|------|
| **负载均衡策略** | EMQX 默认使用 **随机 + 连接局部性** 策略，不保证严格轮询 |
| **Retain 消息** | **默认不发送给共享订阅者**（可通过配置开启，但非标准行为） |
| **组隔离** | 组名完全隔离，`g1` 与 `G1` 是不同组（大小写敏感） |
| **订阅合法性** | `$share/<非空组名>/<有效过滤器>`，否则 SUBACK 失败 |
| **与普通订阅关系** | 共享订阅和普通订阅**互不影响**，消息会同时路由到两类订阅者 |

---

### ✅ 覆盖维度总结

| 维度 | 是否覆盖 |
|------|--------|
| 基本负载均衡 | ✅ |
| 多组广播 | ✅ |
| 通配符支持 | ✅ |
| QoS 支持 | ✅ |
| Retain 消息处理 | ✅ |
| 非法格式拒绝 | ✅ |
| 与普通订阅共存 | ✅ |
| 客户端动态加入/离开 | ✅ |
| 大小写敏感 | ✅ |
| 系统主题隔离 | ✅ |

---